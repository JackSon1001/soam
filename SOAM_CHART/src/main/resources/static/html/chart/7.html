<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="/chart/js/echarts.common.min.js"></script>
<script src="/chart/resource/jquery/3.1.0/jquery-3.1.0.min.js"></script>
<script src="/chart/js/constants.js" type="text/javascript"></script>
</head>
<body>
	<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
	<div id="main" style="width: 100%; height: 100%;"></div>
	<script type="text/javascript">
		
		
		var xtData = Constants.CSG_SYSTEM.getDataList();
		var _names = [];
		
		// 基于准备好的dom，初始化echarts实例
		var div = document.getElementById('main');
		//用于使chart自适应高度和宽度,通过窗体高宽计算容器高宽
		var resizeWorldMapContainer = function () {
			div.style.width = window.innerWidth - 50 +'px';
			div.style.height = window.innerHeight - 50 +'px';
		};
		resizeWorldMapContainer();
		var myChart = echarts.init(div);
		$.ajax({
			type : "POST",
			url : "/chart/chart/statisticsErrorSystem/",
			contentType : "application/json",
			dataType : "json",
			beforeSend : function(XHR) {
				myChart.showLoading();
			},
			complete : function(XHR, status) {
				myChart.hideLoading();
			},
			success : function(data) {
				var counts = data.body.counts;
				for ( var x in xtData) {
					for(var i in counts){
						if(counts[i].name == xtData[x].id){
							_names.push(xtData[x].name);
							counts[i].name = xtData[x].name;
						}
						
					}
					
				}
				option = {
					    title : {
					        text: '各大系统请求失败百分比',
					        x:'center'
					    },
					    tooltip : {
					        trigger: 'item',
					        formatter: "{a} <br/>{b} : {c} ({d}%)"
					    },
					    legend: {
					        orient: 'vertical',
					        left: 'left',
					        data: _names,
					        height: div.style.height,
					        width: div.style.width
					    },
					    series : [
							
					        {
					            name: '',
					            type: 'pie',
					            radius : '55%',
					            center: ['50%', '60%'],
					            data:data.body.counts,
					            itemStyle: {
					                emphasis: {
					                    shadowBlur: 10,
					                    shadowOffsetX: 0,
					                    shadowColor: 'rgba(0, 0, 0, 0.5)'
					                }
					            }
					        }
					    ]
					};
				
				myChart.setOption(option);
			}
		});
		
		//用于使chart自适应高度和宽度
		window.onresize = function () {
		    //重置容器高宽
		    resizeWorldMapContainer();
		    myChart.resize();
		};
	</script>
</body>
</html>