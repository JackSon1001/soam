<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="/chart/js/echarts.common.min.js"></script>
<script src="/chart/resource/jquery/3.1.0/jquery-3.1.0.min.js"></script>
<script src="/chart/js/constants.js" type="text/javascript"></script>
</head>
<body>
	<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
	<div id="main" style="width: 100%; height: 400px;"></div>
	<script type="text/javascript">
		// 基于准备好的dom，初始化echarts实例
		var div = document.getElementById('main');
		//用于使chart自适应高度和宽度,通过窗体高宽计算容器高宽
		var resizeWorldMapContainer = function() {
			div.style.width = window.innerWidth - 50 + 'px';
			div.style.height = window.innerHeight - 50 + 'px';
		};
		resizeWorldMapContainer();
		var myChart = echarts.init(div);
		var xtData = Constants.CSG_SYSTEM.getDataList();
		var _names = [];
		for ( var x in xtData) {
			_names.push(xtData[x].name);
		}

		option = {
			tooltip : {
				trigger : 'axis',
				axisPointer : { // 坐标轴指示器，坐标轴触发有效
					type : 'shadow' // 默认为直线，可选为：'line' | 'shadow'
				}
			},
			legend : {
				data : [ '服务请求次数', '服务请求成功次数' ]
			},
			grid : {
				left : '3%',
				right : '4%',
				bottom : '3%',
				containLabel : true
			},
			xAxis : [ {
				type : 'category',
				data : _names
			} ],
			yAxis : [ {
				type : 'value'
			} ],
			series : [ {
				name : '服务请求次数',
				type : 'bar',
				barWidth : 50,
				data : []
			}, {
				name : '服务请求成功次数',
				type : 'bar',
				barWidth : 50,
				data : []
			} ]
		};

		myChart.setOption(option);

		$.ajax({
			type : "POST",
			url : "/chart/chart/success/",
			contentType : "application/json",
			dataType : "json",
			beforeSend : function(XHR) {
				myChart.showLoading();
			},
			complete : function(XHR, status) {
				myChart.hideLoading();
			},
			success : function(data) {
				myChart.setOption({
					series : data.body.result
				});
			}
		});
		//用于使chart自适应高度和宽度
		window.onresize = function () {
		    //重置容器高宽
		    resizeWorldMapContainer();
		    myChart.resize();
		};
	</script>
</body>
</html>