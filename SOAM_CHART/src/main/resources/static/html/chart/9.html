<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="/chart/js/echarts.common.min.js"></script>
<script src="/chart/resource/jquery/3.1.0/jquery-3.1.0.min.js"></script>
<script src="/chart/js/constants.js" type="text/javascript"></script>
</head>
<body>
	<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
	<div id="main" style="width: 100%; height: 400px;"></div>
	<script type="text/javascript">
		// 基于准备好的dom，初始化echarts实例
		var myChart = echarts.init(document.getElementById('main'));
		var charData = [];
		var now = new Date().getTime();
		var oneMin = 60 * 1000;
		option = {
			title : {
				text : '实时服务请求数'
			},
			tooltip : {
				trigger : 'axis',
				/* formatter : function(params) {
					params = params[0];
					var date = new Date(params.name);
					return date.getDate() + '/' + (date.getMonth() + 1) + '/'
							+ date.getFullYear() + ' : ' + params.value[1];
				}, */
				axisPointer : {
					animation : false
				}
			},
			xAxis : {
				type : 'time',
				splitLine : {
					show : false
				}
			},
			yAxis : {
				type : 'value',
				boundaryGap : [ 0, '100%' ],
				splitLine : {
					show : false
				}
			},
			series : [ {
				name : '实时服务请求数',
				type : 'line',
				showSymbol : false,
				hoverAnimation : false
			} ]
		};
		myChart.setOption(option);
		
		function getData(){
			$.ajax({
				type : "POST",
				url : "/chart/chart/constantly/",
				contentType : "application/json",
				dataType : "json",
				data : JSON.stringify({
					"service_id" : now
				}),
				success : function(data) {
					now += oneMin;
					if(charData.length > 100){
						charData.shift();
					}
					charData.push(data.body.count);

					myChart.setOption({
						series : [ {
							data : charData
						} ]
					});
				}
			});
		}
		getData();
		setInterval(function() {
			getData()
		}, 1000);
	</script>
</body>
</html>